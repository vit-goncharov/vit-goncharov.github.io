function resizeVideo(){if($(".greeting").length){var t=$(".greeting").width(),a=0,e=0;$(".greeting iframe").length&&t<=1200&&(a=t,e=Math.floor(.5625*a),a>640&&(a=640,e=360),$(".greeting iframe").attr("width",a),$(".greeting iframe").attr("height",e))}}$(window).resize(function(){resizeVideo()}),$(document).ready(function(){function t(t){var e=$(this),o=$("#program-map"),n=o.find("#program-map-event-id"),r=o.find("#program-map-reason"),i=$("#program-map-wrapper");i.show(),r.hide(),null!=a&&a.destroy();var s=[];if("value"==e.attr("class"))e.data("id")&&n.val(e.data("id")),s=e.data("coords").split(",");else if("form-control"==e.attr("class")){var d=e.find("option:selected").data("coords");d&&(s=d.split(","))}if(s)if(a=new ymaps.Map("program-map-wrapper",{center:2==s.length?s:[37.622093,55.753994],zoom:16,controls:["zoomControl"]}),a.behaviors.disable("scrollZoom"),s.length>0){var l="";if("value"==e.attr("class"))l="<h4>"+e.data("name")+'</h4><p class="date-time">'+e.data("date-when")+" в "+e.data("time-when")+'</p><p class="addr">'+e.data("addr")+"</p>";else if("form-control"==e.attr("class")){var c=e.find("option:selected");l="<h4>"+c.data("name")+'</h4><p class="date-time">'+c.data("date-when")+" в "+c.data("time-when")+'</p><p class="addr">'+c.data("addr")+"</p>"}var p=new ymaps.Placemark(s,{balloonContentBody:l},{preset:"twirl#redStretchyIcon",draggable:!1});a.geoObjects.add(p)}else{var u=new ymaps.Clusterer({preset:"islands#invertedVioletClusterIcons",groupByCoordinates:!1,clusterDisableClickZoom:!1,clusterHideIconOnBalloonOpen:!1,geoObjectHideIconOnBalloonOpen:!1,hasBalloon:!0}),m=[];n.find("option").each(function(t,a){var e=$(this),o="<h4>"+e.data("name")+'</h4><p class="addr">'+e.data("addr")+"</p>";e.val()&&m.push(new ymaps.Placemark(e.data("coords").split(","),{balloonContentBody:o,clusterCaption:e.data("date-when")+" в "+e.data("time-when")},{preset:"islands#violetIcon"}))}),u.add(m),a.geoObjects.add(u),a.setBounds(u.getBounds(),{checkZoomRange:!0})}else i.hide(),r.text("Координаты события не обнаружены"),r.show()}resizeVideo(),$("#guest .btn-accept").on("click",function(t){var a=$(this),e=a.data("guestUid"),o=$("#guest-comment").val(),n=$("#guest-email").val();a.attr("disabled",!0).text(a.data("btn-loading")),$.ajax({type:"POST",dataType:"JSON",url:"/main/accept",data:{guest_uid:e,guest_comment:o,guest_email:n},error:function(){a.text(a.data("btn-error"))},success:function(t){t&&t.status?($("#guest .tablenum").removeClass("hidden"),a.text(a.data("btn-thanks")),$("#guest #guest-comment").hide()):a.text(a.data("btn-error"))}})}),$("#guest .btn-save-info").on("click",function(t){var a=$(this),e=a.data("guestUid"),o=$("#guest-email").val();a.attr("disabled",!0).text(a.data("btn-loading")),$.ajax({type:"POST",dataType:"JSON",url:"/main/saveemail",data:{guest_uid:e,guest_email:o},error:function(){a.text(a.data("btn-error"))},success:function(t){t&&t.status?(a.text(a.data("btn-thanks")),setTimeout(function(){a.attr("disabled",!1).text(a.data("btn-title"))},5e3)):a.text(a.data("btn-error"))}})}),$("#pool .btn-accept-pool").on("click",function(t){var a=$(this),e=$("#form-pool");a.attr("disabled",!0).text(a.data("btn-loading")),$.ajax({type:"POST",dataType:"JSON",url:"/main/acceptpool",data:e.serialize(),error:function(){a.text(a.data("btn-error"))},success:function(t){t&&t.status?(a.text(a.data("btn-thanks")),setTimeout(function(){a.attr("disabled",!1).text(a.data("btn-title"))},5e3)):t&&!t.status?(a.text(t.reason),setTimeout(function(){a.attr("disabled",!1).text(a.data("btn-title"))},5e3)):a.text(a.data("btn-error"))}})}),$(".nav li a").on("click",function(t){t.preventDefault();var a=$(this),e=a.attr("href"),o=40,n=$(e).offset().top+o,r=n-o<0?0:n-o;$("body, html").animate({scrollTop:n},300).animate({scrollTop:r},600)}),$("#totop .arrow").on("click",function(t){$("body, html").animate({scrollTop:0},500)}),toastr.options={closeButton:!0,debug:!1,newestOnTop:!1,progressBar:!1,positionClass:"toast-bottom-full-width",preventDuplicates:!1,onclick:null,showDuration:"100",hideDuration:"1000",timeOut:"10000",extendedTimeOut:"500",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},location.pathname.indexOf("preview")!=-1&&toastr.info($("#preview-alarm").val());var a;$("#program p.addr span.value").on("click",t),$("#program-map #program-map-event-id").on("change",t)});